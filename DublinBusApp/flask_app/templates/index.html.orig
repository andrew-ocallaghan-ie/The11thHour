<!DOCTYPE html>

<html>
    
    <head>
        
        <title>Dublin Bus Predictions</title>
        
        <!-- Add icon library -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <!--Google Fonts-->
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
        
        <!--Responsive Design-->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!--Encoding-->
        <meta charset="utf-8">

        <!--Bootstrap CSS Links-->
        <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="../static/bootstrap/js/bootstrap.min.js"></script>
        
        <!--Our Stylesheet, goes at bottom of CSS sheets to ensure precedence-->
        <link href='../static/style.css' rel='stylesheet' type="text/css">
        
        <!--ChartJS-->
        <script src="../static/chartjs/node_modules/chart.js/dist/Chart.js"></script>

        <!--Our functions-->
        <script type="text/javascript">
        // Google Map
        function myMap() {
            $.getJSON('http://localhost:5000/api/routes/{{users_route}}', function(json) {
                // Looping through elements in JSON file.
                for (var i = 0; i < json.stops.length; i++) {
                    // Creating Marker
                    var marker = new google.maps.Marker({
                        position: {lat: parseFloat(json.stops[i].latitude), lng: parseFloat(json.stops[i].longitude)},
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            strokeColor: '#4682b4',
                            strokeWeight: 1.5,
                            fillColor: '#4682b4',
                            fillOpacity: 0.4,
                            scale: 8
                        },
                        map: map});
                    // Create infowindow on mouseover
                    var infowindow = new google.maps.InfoWindow();
                    // Contents of infowindow
                    var html = '<h4>' + json.stops[i].shortname + '</h4>';
                    marker.html = html;
                    // Name of station
                    marker.name = json.stops[i].shortname;
                    // Mouse Over Functionality
                    google.maps.event.addListener(marker,'mouseover',function() {
                        // Set contents
                        infowindow.setContent(this.html);
                        // Open infowindow
                        infowindow.open(map, this);
                    });
                }
            });
            
            
<<<<<<< HEAD
            // dublin bikes
            $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
            jQuery.getJSON($SCRIPT_ROOT+"/all",null,function(data){
=======
            //dublin bike
             $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};       jQuery.getJSON($SCRIPT_ROOT+"/all",null,function(data){
>>>>>>> add-markers
           //window.alert(JSON.stringify(data));
            var stations = data.stations;
           //window.alert(JSON.stringify(stations));
            _.forEach(stations,function(station){
                var marker = new google.maps.Marker({
                    position:{
                        lat:station.Position_lat,
                        lng:station.Position_lng
                    },
                    icon: {
                            path: google.maps.SymbolPath.CIRCLE,
<<<<<<< HEAD
                            strokeColor: '#7442b6',
                            strokeWeight: 1.5,
                            fillColor: '#7442b6',
=======
                            strokeColor:'#123456',
                            strokeWeight: 1.5,
                            fillColor: '#123456',
>>>>>>> add-markers
                            fillOpacity: 0.4,
                            scale: 8
                        },
                    map:map,
                    title:station.Name,
                    station_number:station.Number
                });
                
            
                infowindow = new google.maps.InfoWindow();
                
                
                marker.addListener("click",function(){
<<<<<<< HEAD
                
                var contentString='<h2>'+'Dublin Bike'+'</br>'+'station no.'+station.Number+'</h2>' +station.Name+'</br>'
                infowindow.setContent(contentString);
                infowindow.open(map, this);
                }); 
=======
                 
                
                var contentString='Dublin Bike'+'</br>'+'station no.'+station.Number+'</br>' +station.Name
                infowindow.setContent(contentString);
                infowindow.open(map, this);
                }); 
                        
>>>>>>> add-markers
                 
            })
            
    });
<<<<<<< HEAD
            
            
=======


>>>>>>> add-markers
            // Centre of map
            var myCenter = new google.maps.LatLng(53.3498,-6.2603);
            // Initializing canvas
            var mapCanvas = document.getElementById("map");
            // Map options
            var mapOptions = {
                center: myCenter,
                zoom: 12
            };
            // Creating map
            var map = new google.maps.Map(mapCanvas, mapOptions);
        }
        // This function adds all of the routes to the routes textbox so we can autocomplete them
        // Currently takes the route from a CSV which can probably be done in a cleaner way
        function dataList() {
            var url, routeInfo;
            url = 'http://localhost:5000/api/all_routes';
            $.getJSON(url, function(data) {
                $(data.route).each(function() {
                    routeInfo = "<option value=" + this.route + "></option>";
                    $('#routes').append(routeInfo);
                });
            });
        }
        // Made this function to get the mid point of a bus route so that the Map would center on it
        // Not sure exactly how it will work yet
        function midLatLong(lat1, long1, lat2, long2) {
            var longDiff = Math.toRadians(long2 - long1);
            //convert to radians
            lat1 = Math.toRadians(lat1);
            lat2 = Math.toRadians(lat2);
            long1 = Math.toRadians(long1);
            var Bx = Math.cos(lat2) * Math.cos(longDiff);
            var By = Math.cos(lat2) * Math.sin(longDiff);
            var midLat = Math.atan2(Math.sin(lat1) + Math.sin(lat2), Math.sqrt((Math.cos(lat1) + Bx) * (Math.cos(lat1) + Bx) + By * By));
            var midLong = long1 + Math.atan2(By, Math.cos(lat1) + Bx);
            return [Math.toDegrees(midLat), Math.toDegrees(midLong)];
        }
        </script>
    
    </head>
    
    <body>
        <nav class="navbar navbar-default">
          <div class="container-fluid">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="#">Dublin Bus</a>
            </div>

              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <form method="post" class="navbar-form navbar-left">
                  <div class="form-group">
                    <input type="text" class="form-control" id="origin" name="origin" placeholder="Start">
                    <input type="text" class="form-control" id="destination" name="destination" placeholder="End">
                    <input type="text" class="form-control" id="user_route" name="user_route" list="routes" placeholder="Route">
                      <datalist id="routes"></datalist>
                      <!--This calls the script to add all of the routes to the textbox for autocomplete-->
                      <script>window.onload=dataList();</script>

                      <select class="form-control" name="now_arrive_depart" id="now_arrive_depart">
                          <option>Now</option>
                          <option>Arrive By</option>
                          <option>Leave At</option>
                      </select>

                  <button type="submit" class="btn btn-default btn-circle">GO!</button>
                  </div>
              </form>
                <ul class="nav navbar-nav navbar-right">
                    <li><img class="img-responsive" id="weather" src="../static/images/flurries.png"/></li>
                </ul>
            </div>
          </div>
        </nav>
        
        <div class="container">
            <div class="row">
                    <div class="col-sm-12 col-lg-6" id="map"></div>
                    <div class="col-sm-6 col-lg-3" id="bus-info">
                        <h2>Bus Info</h2>
                        <ul>
                            <li>42a - 2.15pm</li>
                            <li>42 - 2.18pm</li>
                            <li>54 - 2.13pm</li>
                            <li>177 - 3.09pm</li>
                            <li>42a - 3.15pm</li>
                        </ul>
                    </div>
                    <!-- Chart -->
                <div class="col-sm-6 col-lg-3">
                    <canvas id="busChart"></canvas>
                </div>

            </div>
 
        </div>

        <!--Script for the chart. Currently uses manual input-->
        <!--Will be cleaner once we have data going in from API-->
        <!--Has to go at the bottom-->

        <script>
            var ctx = document.getElementById("busChart");
            var chartDemo = new Chart(ctx, {
             type: 'line',
             data: {
             labels: ["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00"],
             datasets: [{
                 fill: true,
                 label: '42a',
                 data: [48,23,32,55,13,33,22,15],
                 backgroundColor: 'rgba(255, 99, 132, 0.2)',
                 borderColor:'rgba(255,99,132,1)',
                 borderWidth: 1
                        },
                       {
                fill: true,
                label: '37',
                data: [12,13,22,8,43,33,23,17],
                backgroundColor: 'rgba(0, 102, 255, 0.2)',
                borderColor:'rgba(0, 102, 255,1)',
                borderWidth: 1}]
                    },
             options: {
                 maintainAspectRatio: false,
                 responsive: true,
                 title: {
                    fontSize: 15,
                    fontFamily: "'Open Sans', 'Helvetica', 'Arial', sans-serif",
                    display: true,
                    text: "Your Route Travel Times"
                 }
             }
            });
        </script>
<<<<<<< HEAD
        
        
        <!--Jquery-->
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <!--lodash-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
=======

        <!--import Lodash-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
        
        <!--import Jquery-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    
>>>>>>> add-markers
        <!--Google Maps API script-->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkUZsgbKCDZNWjntnPv5mQJplie2G4h64&callback=myMap"></script>
            
        <!--Google Maps marker clustering script-->
        <script src="../static/marker_clustering/markerclusterer.js"></script>
    
    </body>

</html>